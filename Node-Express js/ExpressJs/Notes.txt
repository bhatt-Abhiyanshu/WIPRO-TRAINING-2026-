npm install express mongoose express-session ejs cookie-parser

User.js

    const mongoose = require("mongoose");
    const userSchema = new mongoose.Schema({
   username:{
    type: String,
    required: true
   },
   password:{
    type:String,
    required:true
   }
});

module.exports = mongoose.model("User", userSchema);



dashboard.ejs

<h2> Welcome <%= user.username%> to our Hotel</h2>

<p> You have successfully logged in!</p>

<a href="/logout">Logout</a>



login.ejs

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h3> Login Page</h3>
    	<form action="/login" method ="Post">
          User Name :   <input type="text" name ="username" placeholder="username" ><br><br>
          Password  :    <input type="text" name ="password" placeholder="password"><br><br>
            <button type="submit" >Login</button>
	    </form>

</body>
</html>


server.js

import { createRequire } from "module";
const require = createRequire(import.meta.url);
var express = require("express")
var cookieParser = require('cookie-parser')
var session = require('express-session')

import  { json, urlencoded } from "express";
const mongoose = require("mongoose")
const User = require("./models/User.js");
var app = express();

app.set("view engine","ejs");

mongoose.connect("mongodb://localhost:27017/authdb")
.then(()=>console.log("Db connected"))
.catch(err => console.error(err));

// Built -in middleware
app.use(json());  // JSON 
app.use(urlencoded({ extended: true })); // Form data

app.use(express.static("views"));
app.use(session({
  secret:'sample-secretkey',
  resave:false,
  saveUninitialized:false
}));


app.get("/demouser" , async(req,res) =>{
await User.create({username: "demouser" , password:"1234"});
res.send("user created");
})

app.get("/login",(req,res)=> res.render("login"));


app.post("/login" , async(req,res) =>{
const user = await User.findOne(req.body);
if(!user) return res.send("invalid credentials");
req.session.user = user;
res.redirect("/dashboard");

});


app.get("/dashboard",(req,res)=> {
    if(!req.session.user) return res.redirect("/login");
res.render("dashboard", {user: req.session.user});

});

app.get("/logout", (req,res)=>{
    req.session.destroy();
    res.redirect("/login");
    
})
app.listen(3000);
console.log("server started");

